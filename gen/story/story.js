// Generated by CoffeeScript 1.9.0
(function() {
  var StoryController, services;

  module.exports = StoryController = function($scope, $location, $routeParams, $timeout, $http, $cordovaFile, $cordovaFileTransfer, $cordovaCamera) {
    var punctuation, storyID;
    $scope.editController = require('./../edit/edit');
    $scope.readController = require('./../read/read');
    console.log($routeParams.id);
    $scope.storyID = storyID = $routeParams.id;
    $scope.pages = $scope.load("story-pages-" + storyID);
    $scope.pageIndex = 0;
    $scope.isEnd = $scope.story.pages.length === 1;
    $scope.isStart = true;
    punctuation = ['(', ')', ',', '...', '!', '?', ';', '.', ':', '"'];
    $scope.nextPage = function() {
      if ($scope.pageIndex < $scope.story.pages(-1)) {
        $scope.pageIndex++;
        return $scope.showPage();
      }
    };
    $scope.prevPage = function() {
      if ($scope.pageIndex > 0) {
        $scope.pageIndex--;
        return $scope.showPage();
      }
    };
    return $scope.showPage = function() {
      var p, text, _i, _len;
      if ($scope.pageIndex === void 0) {
        $scope.pageIndex = 0;
      }
      text = $scope.story.pages[$scope.pageIndex].text;
      for (_i = 0, _len = punctuation.length; _i < _len; _i++) {
        p = punctuation[_i];
        text = S(text).replaceAll(p, " " + p + " ").s;
      }
      text = S(text).collapseWhitespace().s;
      return $scope.words = text.split(" ");
    };
  };

  services = ['$scope', '$location', '$routeParams', '$timeout', '$http'];

  if (this.isPhoneGap) {
    services.push('$cordovaFile');
    services.push('$cordovaFileTransfer');
    services.push('$cordovaCamera');
  }

  StoryController.$inject = services;

}).call(this);
