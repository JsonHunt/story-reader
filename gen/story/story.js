// Generated by CoffeeScript 1.9.0
(function() {
  var StoryController, mediaService, services, storyService;

  storyService = require('./../story-service');

  mediaService = require('./../media-service');

  module.exports = StoryController = function($scope, $location, $routeParams, $timeout, $http, $cordovaFile, $cordovaFileTransfer, $cordovaCamera) {
    console.log("Story ID: " + $routeParams.id);
    storyService.selectStory(parseInt($routeParams.id));
    $scope.pages = storyService.getPages();
    $scope.pageIndex = 0;
    $scope.page = $scope.pages[0];
    $scope.mode = 'read';
    $scope.isStart = function() {
      return $scope.pageIndex === 0;
    };
    $scope.isEnd = function() {
      return $scope.pageIndex + 1 >= $scope.pages.length;
    };
    $scope.stopMedia = function() {
      return mediaService.stop();
    };
    $scope.nextPage = function() {
      mediaService.stop();
      if (!this.isEnd()) {
        $scope.pageIndex++;
        return $scope.page = $scope.pages[$scope.pageIndex];
      }
    };
    $scope.prevPage = function() {
      mediaService.stop();
      if (!this.isStart()) {
        $scope.pageIndex--;
        return $scope.page = $scope.pages[$scope.pageIndex];
      }
    };
    $scope.home = function() {
      return $scope.goto('');
    };
    $scope.toggleOptions = function() {
      mediaService.stop();
      return $scope.options = !$scope.options;
    };
    $scope.toggleEditPageText = function() {
      $scope.textEdit = !$scope.textEdit;
      if ($scope.textEdit) {
        return setTimeout(function() {
          return $('#pagetext').focus();
        }, 50);
      }
    };
    $scope.toggleEditMode = function() {
      if ($scope.mode === 'edit') {
        return $scope.mode = 'read';
      } else {
        return $scope.mode = 'edit';
      }
    };
    $scope.deletePage = function() {
      if ($scope.pages.length === 1) {
        return;
      }
      storyService.removePage($scope.page.id);
      $scope.confirmDeletePage = false;
      if ($scope.pageIndex >= $scope.pages.length) {
        $scope.pageIndex--;
      }
      return $scope.page = $scope.pages[$scope.pageIndex];
    };
    $scope.addPage = function() {
      var pageNumber;
      pageNumber = $scope.pages.length + 1;
      storyService.addPage("Page " + pageNumber);
      $scope.nextPage();
      return setTimeout(function() {
        return $('#pagetext').focus();
      }, 50);
    };
    $scope.savePage = function() {
      storyService.savePage($scope.page);
      console.log("Page saved");
      return $scope.textEdit = false;
    };
    $scope.googleImage = function() {
      return $scope.imageSearch = true;
    };
    $scope.selectImage = function() {
      return $scope.imageSearch = false;
    };
    return $scope.read = function(word) {
      mediaService.stop();
      if (word === void 0) {
        return;
      }
      if (this.reading === word) {
        return delete reading;
      } else {
        this.reading = word;
        return mediaService.play(this.word.recordingPath, function() {
          return $scope.$apply(function() {
            return delete $scope.word;
          });
        });
      }
    };
  };

  services = ['$scope', '$location', '$routeParams', '$timeout', '$http'];

  if (this.isPhoneGap) {
    services.push('$cordovaFile');
    services.push('$cordovaFileTransfer');
    services.push('$cordovaCamera');
  }

  StoryController.$inject = services;

}).call(this);
