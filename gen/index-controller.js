// Generated by CoffeeScript 1.9.0
(function() {
  var IndexController;

  module.exports = IndexController = function($scope, $location, $cordovaFile) {
    var storiesString, wordsString;
    storiesString = window.localStorage.getItem("stories");
    if (storiesString == null) {
      storiesString = JSON.stringify([]);
    }
    $scope.stories = JSON.parse(storiesString);
    wordsString = window.localStorage.getItem("words");
    if (wordsString == null) {
      wordsString = JSON.stringify([]);
    }
    $scope.allWords = JSON.parse(wordsString);
    window.addEventListener('native.keyboardshow', function(e) {
      return $scope.$apply(function() {
        return $scope.keyboard = true;
      });
    });
    window.addEventListener('native.keyboardhide', function(e) {
      return $scope.$apply(function() {
        return $scope.keyboard = false;
      });
    });
    $scope.goto = function(path) {
      return $location.path(path);
    };
    $scope.back = function() {
      return window.history.back();
    };
    $cordovaFile.checkDir(cordova.file.externalDataDirectory, "story-reader-files").then(function(success) {
      console.log("story-reader-files folder exists");
      return $scope.checkFiles();
    }, function(error) {
      if (error.message === 'NOT_FOUND_ERR') {
        return $cordovaFile.createDir(cordova.file.externalDataDirectory, "story-reader-files").then(function(success) {
          console.log("Created story-reader-files folder");
          return $scope.checkFiles();
        }, function(error) {
          return console.log("Error: " + error);
        });
      } else {
        return console.log("Error checking for recording directory : " + JSON.stringify(error));
      }
    });
    $scope.recordings = {};
    return $scope.checkFiles = function() {
      return window.resolveLocalFileSystemURL(cordova.file.externalDataDirectory + 'story-reader-files', function(fileEntry) {
        $scope.folderPath = fileEntry.toURL();
        console.log("Folder path : " + $scope.folderPath);
        return async.each($scope.allWords, function(w, cb) {
          var path;
          path = "story-reader-files/" + w + ".mp3";
          return $cordovaFile.checkFile(cordova.file.externalDataDirectory, path).then(function(success) {
            console.log("Found file: " + JSON.stringify(success));
            $scope.recordings[w.toLowerCase()] = success;
            return cb();
          }, function(error) {
            return cb();
          });
        }, function(err) {
          if (err) {
            console.log(err);
          }
          return console.log("Checked all words");
        });
      }, function(error) {
        return console.log("Error getting folder URL : " + JSON.stringify(error));
      });
    };
  };

  IndexController.$inject = ['$scope', '$location', '$cordovaFile'];

}).call(this);
