// Generated by CoffeeScript 1.9.0
(function() {
  var S, StoryParser, _;

  S = require("string");

  _ = require("underscore");

  StoryParser = (function() {
    function StoryParser() {}

    StoryParser.prototype.parse = function(text) {
      var message, p, punctuation, result, sentenceReg, storyReg, word, words, _i, _len;
      result = {
        words: [],
        sentences: []
      };
      if (!S(text).endsWith('.') || !S(text).endsWith('!') || !S(text).endsWith('?') || !S(text).endsWith('...')) {
        text += '.';
      }
      storyReg = /[\s\S]*?[\.\!\?](\.\.)?/gm;
      punctuation = ['(', ')', ',', '...', '!', '?', ';', '.', ':', '"'];
      for (_i = 0, _len = punctuation.length; _i < _len; _i++) {
        p = punctuation[_i];
        text = S(text).replaceAll(p, " " + p + " ");
      }
      while (message = storyReg.exec(text)) {
        sentenceReg = /\S+/gm;
        words = [];
        while (word = sentenceReg.exec(message[0])) {
          if (words.length === 0) {
            word[0] = S(word[0]).capitalize().s;
          }
          words.push(word[0]);
          if (!_.contains(result.words, word[0].toLowerCase()) && !_.contains(punctuation, word[0])) {
            result.words.push(word[0].toLowerCase());
          }
        }
        if (words.length === 0) {
          continue;
        }
        if (words.length === 1 && _.contains(punctuation, words[0])) {
          continue;
        }
        result.sentences.push({
          words: words
        });
      }
      return result;
    };

    return StoryParser;

  })();

  module.exports = new StoryParser();

}).call(this);
