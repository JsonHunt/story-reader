// Generated by CoffeeScript 1.9.0
(function() {
  var RecordController;

  module.exports = RecordController = function($scope, $timeout, $cordovaMedia) {
    setTimeout(function() {
      return $('.title').focus();
    }, 100);
    window.addEventListener('native.keyboardshow', function(e) {
      return $scope.$apply(function() {
        return $scope.keyboard = true;
      });
    });
    window.addEventListener('native.keyboardhide', function(e) {
      return $scope.$apply(function() {
        return $scope.keyboard = false;
      });
    });
    $scope.rec = {};
    $scope.recording = false;
    $scope.blur = function() {
      $('.title').blur();
      return $timeout(function() {
        return $scope.allowRec = true;
      }, 1000);
    };
    $scope.back = function() {
      if ($scope.recording) {
        $scope.media.stopRecord();
      }
      if ($scope.playing) {
        $scope.media.stop();
      }
      return window.history.back();
    };
    $scope.record = function() {
      $scope.recording = true;
      $scope.mediaSource = $scope.rec.title + ".mp3";
      $scope.media = new Media($scope.mediaSource, function(success) {
        return console.log("Success");
      }, function(error) {
        return console.log(JSON.stringify(error));
      }, function(status) {
        return console.log(JSON.stringify(status));
      });
      return $scope.media.startRecord();
    };
    $scope.stop = function() {
      if ($scope.recording) {
        $scope.media.stopRecord();
        $scope.recording = false;
        $scope.rec.url = $scope.mediaSource;
      }
      if ($scope.playing) {
        $scope.media.stop();
        return $scope.playing = false;
      }
    };
    $scope.play = function() {
      $scope.media = new Media($scope.mediaSource, function(success) {
        return $scope.$apply(function() {
          return $scope.playing = false;
        });
      }, function(error) {
        console.log(JSON.stringify(error));
        return $scope.$apply(function() {
          return $scope.playing = false;
        });
      }, function(status) {
        return console.log(JSON.stringify(status));
      });
      $scope.media.play();
      return $scope.playing = true;
    };
    return $scope.save = function() {
      var r, title;
      title = $scope.rec.title;
      if (title === void 0 || title.length === 0) {
        $scope.error = "Please enter a title";
        $('.title').focus();
        return;
      }
      $scope.recordings.push($scope.rec);
      r = JSON.stringify($scope.recordings);
      window.localStorage.setItem('recordings', r);
      return $scope.goto('manage');
    };
  };

  RecordController.$inject = ['$scope', '$timeout', '$cordovaMedia'];

}).call(this);
